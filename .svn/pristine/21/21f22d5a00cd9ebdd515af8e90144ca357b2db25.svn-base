<?php
if (! defined ( 'BASEPATH' ))
	exit ( 'No direct script access allowed' );
class Examination extends CI_Controller {
	private $queue1cont;
	private $queue2cont;
	private $queue3cont;
	private $queue4cont;
	private $queue5cont;
	private $positionCtr;
	
	public function __construct() {
		parent::__construct ();
		
		$this->load->model ( 'examination_model' );
		$this->load->model ( 'Patient' );
		$this->load->model ( 'Visit' );
		$this->load->driver ( 'session' );
		$this->load->helper ( 'form' );
		
		$this->positionPattern = array (
				2,
				3,
				2,
				4,
				3,
				2,
				5,
				2,
				3,
				4 
		);
		$this->positionMax = 10;
		$this->positionCtr = 0;
	}
	public function visit($visitId = 0) {
		$rowInfo = $this->examination_model->get_patient_visit_info_row ( $visitId );
		$data ['last_name'] = $rowInfo ['last_name'];
		$data ['first_name'] = $rowInfo ['first_name'];
		$data ['existing_conditions'] = $rowInfo ['existing_conditions'];
		$data ['medication1'] = $rowInfo ['medication1'];
		$data ['medication2'] = $rowInfo ['medication2'];
		$data ['medication3'] = $rowInfo ['medication3'];
		$data ['primary_physician'] = $rowInfo ['primary_physician'];
		$data ['phone_num_home'] = $rowInfo ['phone_num_home'];
		$data ['phone_num_emergency'] = $rowInfo ['phone_num_emergency'];
		$data ['primary_complaint'] = $rowInfo ['primary_complaint'];
		$data ['symptom1'] = $rowInfo ['symptom1'];
		$data ['symptom2'] = $rowInfo ['symptom2'];
		$data ['code'] = $rowInfo ['code'];
		$data ['page_title'] = 'Clinic - Visit';
		$this->load->template ( 'examination/visit', $data );
	}
	private function sendData() {
	}
	public function dequeue() {
		// check code 1 first
		if ($this->positionCtr < $this->positionMax) {
			$queuename = $this->positionPattern [$this->positionCtr];
			switch ($queuename) {
				case "2" :
					echo 'case 2 '.count ( $this->queue2cont ).' '.$this->queue2cont;
					if (count ( $this->queue2cont ) != 0) {
						$visit = array_shift ( $this->queue2cont );
						$this->visit ( $visit->getVisit_id () );
					}
					break;
				case "3" :
					echo 'case 3 '.count ( $this->queue3cont );
					if (count ( $this->queue3cont ) != 0) {
						$visit = array_shift ( $this->queue3cont );
						$this->visit ( $visit->getVisit_id () );
					}
					break;
				case "4" :
					echo 'case 4 '.count ( $this->queue4cont );
					if (count ( $this->queue4cont ) != 0) {
						$visit = array_shift ( $this->queue4cont );
						$this->visit ( $visit->getVisit_id () );
					}
					break;
				case "5" :
					echo 'case 5 '.count ( $this->queue5cont );
					if (count ( $this->queue5cont ) != 0) {
						$visit = array_shift ( $this->queue5cont );
						$this->visit ( $visit->getVisit_id () );
					}
					break;
			}
			$this->positionCtr = $this->positionCtr + 1;
		}
	}
	public function _output($output) {
		echo $output;
	}
	public function index() {
		$data ['pagetitle'] = 'Clinic - Examination';
		
		// if ($user_priv != "3") {
		// redirect ( '/home', 'refresh' );
		// }
		
		$amount1 = $this->examination_model->getQueueCount ( '1' );
		$amount2 = $this->examination_model->getQueueCount ( '2' );
		$amount3 = $this->examination_model->getQueueCount ( '3' );
		$amount4 = $this->examination_model->getQueueCount ( '4' );
		$amount5 = $this->examination_model->getQueueCount ( '5' );
		
		$data ['queue1'] = $amount1;
		$data ['queue2'] = $amount2;
		$data ['queue3'] = $amount3;
		$data ['queue4'] = $amount4;
		$data ['queue5'] = $amount5;
		
		$this->queue1cont = $this->examination_model->get_visit_models_in_queue ( "1" );
		echo 'visits in queue1 ' . count ( $this->queue1cont );
		$this->queue2cont = $this->examination_model->get_visit_models_in_queue ( "2" );
		echo 'visits in queue2 ' . count ( $this->queue2cont );
		$this->queue3cont = $this->examination_model->get_visit_models_in_queue ( "3" );
		echo 'visits in queue3 ' . count ( $this->queue3cont );
		$this->queue4cont = $this->examination_model->get_visit_models_in_queue ( "4" );
		echo 'visits in queue4 ' . count ( $this->queue4cont );
		$this->queue5cont = $this->examination_model->get_visit_models_in_queue ( "5" );
		echo 'visits in queue5 ' . count ( $this->queue5cont );
		// $this->load->view ( 'examination', $data );
		$this->load->template ( 'examination/examination', $data );
	}
}

/**
 * INSERT INTO PATIENT(RAMQ_ID,LAST_NAME,FIRST_NAME,PHONE_NUM_HOME,PHONE_NUM_EMERGENCY,PRIMARY_PHYSICIAN
    ,existing_conditions,medication1,medication2,medication3) VALUES(123,"Ram","John","5142222222","5142332222","Dr.Mario","Concussion","","","");
    
    INSERT INTO PATIENT(RAMQ_ID,LAST_NAME,FIRST_NAME,PHONE_NUM_HOME,PHONE_NUM_EMERGENCY,PRIMARY_PHYSICIAN
    ,existing_conditions,medication1,medication2,medication3) VALUES(123,"Smith","Benoit","5142456592","5142332652","Dr.Luigi","Concussion","","","");
    
    INSERT INTO PATIENT(RAMQ_ID,LAST_NAME,FIRST_NAME,PHONE_NUM_HOME,PHONE_NUM_EMERGENCY,PRIMARY_PHYSICIAN
    ,existing_conditions,medication1,medication2,medication3) VALUES(123,"Woods","Marcus","5142561222","5142349122","Dr.Wario","Concussion","","","");
    
    INSERT INTO PATIENT(RAMQ_ID,LAST_NAME,FIRST_NAME,PHONE_NUM_HOME,PHONE_NUM_EMERGENCY,PRIMARY_PHYSICIAN
    ,existing_conditions,medication1,medication2,medication3) VALUES(123,"Laten","Bio","5119478222","5142163422","Dr.Sahib","Concussion","","","");
CREATE TABLE IF NOT EXISTS user (
	`user_id` int auto_increment PRIMARY KEY,
	`hashed_password` varchar(255) NOT NULL,
	`invalid_login_counter` int default 0,
	`privilege_level` int default 1
	/* privilege_level possible values:
	 * 1 = reception
	 * 2 = triage
	 * 3 = nurse
	 * 4 = admin
INSERT INTO USERS(hashed_password,privilege_level) values ("funfun",3);
 * 
 */
/* End of file examinationCTL.php */